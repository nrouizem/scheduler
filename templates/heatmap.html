<!doctype html>
<html lang="en">
  <head>
    <title>Schedule Quality Heatmap</title>
    <meta charset="utf-8">
    <style>
      .heatmap-grid {
        display: grid;
        grid-template-columns: 100px repeat({{ times_by_day|length }}, 1fr);
        gap: 2px;
      }
      .heatmap-cell {
        text-align: center;
        padding: 4px;
        font-size: 0.8rem;
        color: #000;
      }
      .score-1 { background-color: #1a9850; }  /* green */
      .score-0-8 { background-color: #91cf60; }
      .score-0-6 { background-color: #d9ef8b; }
      .score-0-4 { background-color: #fee08b; }
      .score-0-2 { background-color: #fc8d59; }
      .score-0 { background-color: #d73027; }  /* red */
    </style>
  </head>
  <body class="container my-4">
    <h1>Focus + Weather Heatmap</h1>
    <div class="heatmap-grid">
      <!-- Header -->
      <div></div>
      {% for date in times_by_day.keys() %}
        <div><strong>{{ date.strftime("%A %b %d") }}</strong></div>
      {% endfor %}

      <!-- Time rows -->
      {% for i in range(times_by_day.values()|first|length) %}
        <div><strong>{{ times_by_day.values()|first[i][0].strftime("%I:%M %p") }}</strong></div>
        {% for scores in times_by_day.values() %}
          {% set val = scores[i][1] %}
          {% if val >= 0.95 %}
            <div class="heatmap-cell score-1">{{ "%.2f"|format(val) }}</div>
          {% elif val >= 0.8 %}
            <div class="heatmap-cell score-0-8">{{ "%.2f"|format(val) }}</div>
          {% elif val >= 0.6 %}
            <div class="heatmap-cell score-0-6">{{ "%.2f"|format(val) }}</div>
          {% elif val >= 0.4 %}
            <div class="heatmap-cell score-0-4">{{ "%.2f"|format(val) }}</div>
          {% elif val >= 0.2 %}
            <div class="heatmap-cell score-0-2">{{ "%.2f"|format(val) }}</div>
          {% else %}
            <div class="heatmap-cell score-0">{{ "%.2f"|format(val) }}</div>
          {% endif %}
        {% endfor %}
      {% endfor %}
    </div>

    <div class="mt-4">
      <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">Back to Dashboard</a>
    </div>
  </body>
</html>
